<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Looking Glass WebXR Library -Testing-</title>
		<link rel="stylesheet" href="../src/index.css" />
	</head>
	<body>
		<div id="root"></div>
		<h1>Looking Glass Bridge.JS Library</h1>
		<h2>Connecting to Bridge via WebSockets</h2>
		<p>
			Looking Glass Bridge uses the concept of <strong>Orchestrations</strong> to manage connections to the
			Looking Glass Display(s). You can click the button below to enter an orchestration and connect to
			Looking Glass Bridge.
		</p>
		<script type="module">
			import { BridgeClient } from "../dist/looking-glass-bridge.mjs"
			const Bridge = new BridgeClient()
			// Connect to Bridge Event Source
			const orchestration_label = document.getElementById("orchestration-label")
			orchestration_label.innerHTML = `Orchestration ID: ${await Bridge.CreateOrchestration()}`

			const QueryDisplays_Button = document.getElementById("query_displays")
			QueryDisplays_Button.addEventListener("click", async () => {
				let response = await Bridge.displays()
				console.log(response)
			})
			const BridgeVersion_Button = document.getElementById("bridge-version")
			BridgeVersion_Button.addEventListener("click", async () => {
				let response = await Bridge.bridgeVersion()
				console.log(response)
			})
			const APIVersion_Button = document.getElementById("api-version")
			APIVersion_Button.addEventListener("click", async () => {
				let response = await Bridge.apiVersion()
				console.log(response)
			})
		</script>
		<label id="orchestration-label">Orchestration ID: </label>
		<div>
			<p>
				After we join an orchestration, we can connect to Looking Glass Bridge's websocket and query display
				parameters.
			</p>
			<button id="query_displays">Query Displays</button>
			<button id="bridge-version">Query Bridge Version</button>
			<button id="api-version">Query API Version</button>
		</div>
		<br />
		<h2>Sending holograms to Bridge</h2>
		<p>
			Looking Glass Bridge 2.2 and above support playing content directly via the API. Try adding a URL in the
			fields below to send a hologram from the web to Looking Glass Bridge.
		</p>
		<script type="module">
			import { BridgeClient } from "../dist/looking-glass-bridge.mjs"
			import { QuiltPlaylistItem, RGBDPlaylistItem } from "../dist/looking-glass-bridge.mjs"

			const Bridge = new BridgeClient()

			Bridge.addEventListener("Playlist Instance", (event) => {
				console.log(event)
				console.log("Playlist Updated")
			})

			const cast_button = document.getElementById("cast-hologram")
			const add_playlist_item_button = document.getElementById("add-playlist-item")
			const playlist = document.getElementById("playlist")

			const urls = [
				"https://s3.amazonaws.com/lkg-blocks/u/9aa4b54a7346471d/steampunk_qs8x13.jpg",
				"https://s3.amazonaws.com/lkg-blocks/u/fe76779b7d724315/yggdrasil_qs8x13.jpg",
				"https://s3.amazonaws.com/lkg-blocks/u/d2a9cc551f2a4dc2/technomancer_qs8x13.jpg",
			]
			let urlIndex = -1

			cast_button.addEventListener("click", async () => {
				let url = urls[++urlIndex % urls.length]
				let rgbd = RGBDPlaylistItem({
					URI: "https://dl.blocks.glass/u/d56ea13faa724297/rgbd.png",
					rows: 8,
					columns: 6,
					aspect: 0.75,
					viewCount: 45,
					depth_loc: 2,
					depth_inversion: 0,
					chroma_depth: 0,
					depthiness: 0,
				})
				let quilt = QuiltPlaylistItem({
					URI: url,
					rows: 13,
					columns: 8,
					aspect: 0.75,
					viewCount: 8 * 13,
				})
				await Bridge.cast(quilt)
			})
		</script>
		<button id="cast-hologram">Cast Hologram</button>
		<li id="playlist"></li>
		<br />
		<h2>Loading a playlist from Looking Glass Studio</h2>
		<button>not working yet</button>
	</body>
</html>
